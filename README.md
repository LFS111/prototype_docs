# 充电桩管理平台需求分析报告

## 1. 项目概述

### 1.1 项目目标
采用“分阶段、模块化、敏捷迭代”的开发思路，实现MVP（最小可行产品）版本上线，包含核心充电服务功能，支持普通用户和政企客户双场景，确保平台快速验证并具备可扩展性。

### 1.2 开发周期
- **MVP阶段**：2-4个月
- **核心目标**：实现基础功能上线，验证业务模式

## 2. 系统模块分析

### 2.1 模块总体架构
系统共分为4个核心模块，总计32个功能点，具体分布如下：

| 模块名称 | 功能点数量 | 核心定位 | 优先级分布 |
|---------|-----------|---------|-----------|
| 核心设备连接服务 | 5个 | 设备通信核心 | P0:3个, 未指定:2个 |
| 用户端服务（微信小程序） | 10个 | 面向普通用户 | P0:3个, 未指定:7个 |
| 核心运营管理后台 | 8个 | 运营管理核心 | P0:1个, P1:3个, 未指定:4个 |
| 政企客户运营 | 8个 | 政企客户服务 | P0:3个, P1:1个, 未指定:4个 |

### 2.2 各模块详细功能

#### 2.2.1 核心设备连接服务（P0级核心）
**功能描述**：负责与充电桩设备的通信连接，是整个平台的基础服务。

| 子模块 | 详细功能 | 技术考量 | 优先级 |
|-------|---------|---------|-------|
| 协议适配层 | 云快充V1.6协议核心指令解析，包括桩登录、心跳、BMS握手、充电实时数据、充电统计、事件上报 | Netty框架处理TCP长连接，工厂模式/策略模式管理协议解析器 | P0 |
| 设备状态管理 | 实时监控6种设备状态，维护最后通信时间，实现离线超时判断 | Redis缓存实时状态，WebSocket推送状态变更 | P0 |
| 远程控制 | 远程启动/停止充电指令下发与响应确认 | 指令超时重试和可靠性机制 | P0 |

#### 2.2.2 用户端服务（微信小程序）
**功能描述**：面向普通用户的充电服务入口，提供完整的充电体验。

| 子模块 | 详细功能 | 技术考量 | 优先级 |
|-------|---------|---------|-------|
| 用户中心 | 手机号+验证码登录、微信一键登录、用户信息管理 | 集成短信服务商，JWT/OAuth 2.0会话管理 | P0 |
| 充电流程 | 扫码充电（安全签名）、充电引导页、实时充电页、手动停止充电 | 二维码安全签名，WebSocket实时数据推送 | P0 |
| 订单与支付 | 充电订单生成、微信支付集成、支付回调处理、订单状态管理 | 支付回调签名验证，订单状态机设计 | P0 |

#### 2.2.3 核心运营管理后台
**功能描述**：面向平台运营人员的管理工具，提供数据监控和运营管理能力。

| 子模块 | 详细功能 | 技术考量 | 优先级 |
|-------|---------|---------|-------|
| 数据概览 | 核心KPI展示：总桩数、在线桩数、今日订单数、今日总收入、实时充电数 | Redis+MySQL数据聚合，性能优化 | P1 |
| 设备管理 | 充电桩信息录入、列表查看、搜索筛选、基础信息编辑 | 桩/枪两级数据库结构设计 | P0 |
| 订单管理 | 订单列表查看、多条件搜索、订单详情查看 | 完整订单表结构设计 | P1 |
| 用户管理 | 注册用户列表查看、账户禁用/启用 | 用户状态管理机制 | P1 |

#### 2.2.4 政企客户运营
**功能描述**：面向政企客户的专属服务，支持白名单、专属桩群、账单管理等功能。

| 子模块 | 详细功能 | 技术考量 | 优先级 |
|-------|---------|---------|-------|
| 政企客户管理 | 客户档案创建、客户状态管理（启用/禁用） | 客户与充电桩关联设计 | P0 |
| 专属充电桩管理 | 桩群分组、组内数据看板 | 客户组维度数据查询设计 | P0 |
| 白名单与权限管理 | 车牌白名单（无感充电）、员工子账号与权限分配 | 即插即充流程设计，RBAC权限模型 | P0 |
| 账单与对账服务 | 周期账单生成、账单明细查询、账单导出 | 后付费模式计费引擎，独立账单表结构 | P1 |

## 3. 优先级分析

### 3.1 优先级分布统计
- **P0级（最高优先级）**：10个功能点，占比31.2%
  - 核心设备连接服务：3个
  - 用户端服务：3个
  - 核心运营管理后台：1个
  - 政企客户运营：3个
- **P1级（次高优先级）**：4个功能点，占比12.5%
  - 主要集中在运营管理后台和政企账单服务
- **未指定优先级**：17个功能点，占比53.1%
  - 建议后续补充优先级定义，便于开发排期

### 3.2 MVP阶段必须实现的功能
1. 核心设备连接服务的全部P0功能
2. 用户端服务的充电全流程P0功能
3. 运营后台的设备管理P0功能
4. 政企客户的白名单和专属桩管理P0功能

## 4. 技术架构设计

### 4.1 分层架构
1. **客户端层**：微信小程序（用户端）、Web管理后台（运营端）
2. **API网关层**：请求路由、认证授权、流量控制
3. **应用服务层**：设备连接服务、用户服务、订单支付服务、运营管理服务、政企客户服务
4. **数据存储层**：MySQL（结构化数据）、Redis（缓存）、MQ（消息队列）
5. **基础设施层**：服务器、网络、安全防护

### 4.2 关键技术选型
- **设备通信**：Netty框架（TCP长连接）
- **实时推送**：WebSocket
- **缓存技术**：Redis
- **认证授权**：JWT/OAuth 2.0
- **权限管理**：RBAC模型
- **数据库**：MySQL（主数据）、Redis（缓存）

## 5. 业务流程分析

### 5.1 普通用户充电流程
1. 用户登录微信小程序
2. 扫描充电桩二维码
3. 系统验证设备状态
   - 设备忙/故障：提示用户（流程结束）
   - 设备空闲：进入下一步
4. 用户发起充电请求，确认参数
5. 系统下发充电指令到充电桩
6. 用户插枪连接车辆
7. 充电桩响应指令，开始充电
8. 实时推送充电数据（电压、电流、费用）
9. 充电停止（用户手动停止或自动停止）
10. 生成充电订单，发起支付
    - 支付完成：订单归档（流程结束）
    - 支付失败：支持重新支付

### 5.2 政企客户充电流程
1. 管理员配置政企客户白名单和专属桩组
2. 政企用户驾驶车辆到达专属充电桩
3. 用户插枪连接车辆（硬件识别车牌/VIN）
4. 系统验证是否在白名单内
   - 不在白名单：拒绝充电（流程结束）
   - 在白名单：自动发起充电
5. 充电桩开始充电，实时上传数据
6. 充电完成自动停止
7. 系统记录充电数据，关联客户账户
8. 周期生成账单（周/月）
9. 政企客户确认账单并完成支付
10. 支持账单查询与导出

## 6. 风险与建议

### 6.1 潜在风险
1. **协议兼容性风险**：当前仅支持云快充V1.6协议，后续可能需要扩展其他协议
2. **性能风险**：实时数据推送和设备状态监控需要考虑高并发场景
3. **安全风险**：支付流程和设备控制需要加强安全验证

### 6.2 建议
1. **优先级补充**：建议为未指定优先级的功能点补充优先级定义
2. **技术预研**：提前进行Netty、WebSocket等关键技术的预研
3. **测试计划**：制定完善的测试计划，重点测试设备通信和支付流程
4. **扩展性设计**：在数据库设计和接口设计时考虑未来扩展性

## 7. 总结

充电桩管理平台MVP阶段以设备连接、用户充电、政企服务为核心，通过4个核心模块实现完整的充电服务闭环。建议按照优先级顺序开展开发，首先实现P0级核心功能，确保平台能够快速上线验证业务模式，同时为后续迭代预留扩展空间。
